{% extends "admin/base.html" %}
{% load i18n %}

{% block content %}
<h1>{{ title }}</h1>

<form method="post" enctype="multipart/form-data">
    {% csrf_token %}

    <fieldset class="module aligned">
        <h2>예산 엑셀 파일 업로드</h2>

        <div class="form-row">
            <label for="fiscal_year">회계연도:</label>
            <input type="number" name="fiscal_year" id="fiscal_year"
                   value="{{ fiscal_year|default:2026 }}" min="2020" max="2099" required>
        </div>

        <div class="form-row">
            <label for="excel_file">엑셀 파일:</label>
            <input type="file" name="excel_file" id="excel_file" accept=".xlsx,.xls" required>
        </div>

        <p class="help">
            <strong>burget_account_template.xlsx 형식</strong><br>
            컬럼: 구분(대분류), 구분(중분류), 구분(소분류), 계정명, 계정명2, 연간예산액<br>
            ※ 업로드 시 계정과목과 예산이 함께 생성됩니다.
        </p>
    </fieldset>

    {% if existing_data %}
    <fieldset class="module aligned" style="border: 2px solid #f0ad4e; background: #fcf8e3;">
        <h2 style="color: #8a6d3b;">기존 데이터 존재</h2>
        <p>{{ fiscal_year }}년 데이터가 이미 등록되어 있습니다.</p>
        <ul style="margin-left: 20px;">
            <li>계정과목: {{ existing_accounts }}건</li>
            <li>예산: {{ existing_budgets }}건</li>
        </ul>
        <p>
            기존 데이터를 삭제하려면 <a href="{% url 'admin:finance_budget_changelist' %}">예산 관리</a> 페이지에서 해당 연도를 삭제해주세요.
        </p>
    </fieldset>
    {% endif %}

    <div class="submit-row">
        <input type="submit" value="업로드" class="default">
        <a href="{% url 'admin:finance_budget_changelist' %}" class="deletelink">취소</a>
    </div>
</form>
{% endblock %}
