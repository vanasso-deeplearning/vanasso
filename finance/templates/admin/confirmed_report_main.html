{% extends "admin/base_site.html" %}
{% load i18n static %}

{% block breadcrumbs %}
<nav aria-label="breadcrumbs">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="{% url 'admin:index' %}">홈</a></li>
        <li class="breadcrumb-item active">월간보고서(확정)</li>
    </ol>
</nav>
{% endblock %}

{% block content %}
<style>
    .confirmed-container {
        max-width: 900px;
    }
    .confirmed-container h1 {
        font-size: 20px;
        margin-bottom: 20px;
        color: #333;
    }
    .year-month-selector {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 20px;
        padding: 15px;
        background: #f5f5f5;
        border-radius: 4px;
    }
    .year-month-selector select {
        padding: 6px 12px;
        font-size: 14px;
        border: 1px solid #ccc;
        border-radius: 4px;
    }
    .year-month-selector .btn-go {
        padding: 6px 15px;
        font-size: 13px;
        background: #417690;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }
    .report-list {
        list-style: none;
        padding: 0;
        margin: 0 0 30px 0;
    }
    .report-item {
        display: block;
        margin-bottom: 12px;
        padding: 15px 20px;
        background: #fff;
        border: 1px solid #ddd;
        border-left: 4px solid #28a745;
        border-radius: 4px;
        text-decoration: none;
        color: #333;
        transition: background 0.2s;
    }
    .report-item:hover {
        background: #f5f9fc;
        text-decoration: none;
    }
    .report-item .number {
        display: inline-block;
        width: 24px;
        height: 24px;
        line-height: 24px;
        text-align: center;
        background: #28a745;
        color: white;
        border-radius: 50%;
        font-size: 12px;
        margin-right: 12px;
    }
    .report-item .title {
        font-size: 15px;
        font-weight: bold;
        color: #28a745;
    }
    .report-item .desc {
        margin-top: 5px;
        margin-left: 36px;
        font-size: 12px;
        color: #888;
    }
    .confirmed-list {
        margin-top: 30px;
    }
    .confirmed-list h2 {
        font-size: 16px;
        margin-bottom: 15px;
        color: #333;
        border-bottom: 2px solid #28a745;
        padding-bottom: 8px;
    }
    .confirmed-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 13px;
    }
    .confirmed-table th, .confirmed-table td {
        border: 1px solid #ddd;
        padding: 8px 12px;
        text-align: center;
    }
    .confirmed-table th {
        background: #f5f5f5;
        font-weight: bold;
    }
    .confirmed-table .type-budget { color: #dc3545; }
    .confirmed-table .type-bank { color: #007bff; }
    .confirmed-table .type-cash { color: #28a745; }
</style>

<div class="confirmed-container">
    <h1>월간보고서(확정)</h1>

    <div class="year-month-selector">
        <label>조회 연월:</label>
        <select id="select_year">
            {% for y in years %}
            <option value="{{ y }}" {% if y == selected_year %}selected{% endif %}>{{ y }}년</option>
            {% endfor %}
        </select>
        <select id="select_month">
            {% for m in months %}
            <option value="{{ m }}" {% if m == selected_month %}selected{% endif %}>{{ m }}월</option>
            {% endfor %}
        </select>
    </div>

    <ul class="report-list">
        <li>
            <a href="{% url 'admin:confirmed_cashbook' book_type='BANK' year=selected_year month=selected_month %}" class="report-item">
                <span class="number">1</span>
                <span class="title">예금출납장(확정)</span>
                <div class="desc">확정된 예금출납장 데이터를 조회합니다.</div>
            </a>
        </li>
        <li>
            <a href="{% url 'admin:confirmed_cashbook' book_type='CASH' year=selected_year month=selected_month %}" class="report-item">
                <span class="number">2</span>
                <span class="title">현금출납장(확정)</span>
                <div class="desc">확정된 현금출납장 데이터를 조회합니다.</div>
            </a>
        </li>
        <li>
            <a href="{% url 'admin:confirmed_budget' year=selected_year month=selected_month %}" class="report-item">
                <span class="number">3</span>
                <span class="title">월간 예산집행 내역(확정)</span>
                <div class="desc">확정된 예산 집행 현황을 조회합니다.</div>
            </a>
        </li>
    </ul>

    <div class="confirmed-list">
        <h2>확정된 보고서 목록</h2>
        {% if confirmed_snapshots %}
        <table class="confirmed-table">
            <thead>
                <tr>
                    <th>연도</th>
                    <th>월</th>
                    <th>보고서 유형</th>
                    <th>확정일시</th>
                    <th>보기</th>
                </tr>
            </thead>
            <tbody>
                {% for snap in confirmed_snapshots %}
                <tr>
                    <td>{{ snap.fiscal_year }}년</td>
                    <td>{{ snap.month }}월</td>
                    <td>
                        {% if snap.snapshot_type == 'BUDGET' %}
                        <span class="type-budget">예산집행내역</span>
                        {% elif snap.snapshot_type == 'CASHBOOK_BANK' %}
                        <span class="type-bank">예금출납장</span>
                        {% elif snap.snapshot_type == 'CASHBOOK_CASH' %}
                        <span class="type-cash">현금출납장</span>
                        {% else %}
                        {{ snap.snapshot_type }}
                        {% endif %}
                    </td>
                    <td>{{ snap.confirmed_at|date:"Y-m-d H:i" }}</td>
                    <td>
                        {% if snap.snapshot_type == 'BUDGET' %}
                        <a href="{% url 'admin:confirmed_budget' year=snap.fiscal_year month=snap.month %}">조회</a>
                        {% elif snap.snapshot_type == 'CASHBOOK_BANK' %}
                        <a href="{% url 'admin:confirmed_cashbook' book_type='BANK' year=snap.fiscal_year month=snap.month %}">조회</a>
                        {% elif snap.snapshot_type == 'CASHBOOK_CASH' %}
                        <a href="{% url 'admin:confirmed_cashbook' book_type='CASH' year=snap.fiscal_year month=snap.month %}">조회</a>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <p style="color: #888; text-align: center; padding: 20px;">확정된 보고서가 없습니다.</p>
        {% endif %}
    </div>
</div>

<script>
document.getElementById('select_year').addEventListener('change', updateLinks);
document.getElementById('select_month').addEventListener('change', updateLinks);

function updateLinks() {
    var year = document.getElementById('select_year').value;
    var month = document.getElementById('select_month').value;

    // 링크 업데이트
    var links = document.querySelectorAll('.report-item');
    links[0].href = "{% url 'admin:confirmed_cashbook' book_type='BANK' year=1 month=1 %}".replace('/BANK/1/1/', '/BANK/' + year + '/' + month + '/');
    links[1].href = "{% url 'admin:confirmed_cashbook' book_type='CASH' year=1 month=1 %}".replace('/CASH/1/1/', '/CASH/' + year + '/' + month + '/');
    links[2].href = "{% url 'admin:confirmed_budget' year=1 month=1 %}".replace('/1/1/', '/' + year + '/' + month + '/');
}
</script>
{% endblock %}
